---
title: "2 - What makes a model?"
subtitle: "Machine learning with tidymodels"
format:
  revealjs: 
    slide-number: true
    footer: <https://workshops.tidymodels.org>
    include-before-body: header.html
    theme: [default, tidymodels.scss]
knitr:
  opts_chunk: 
    echo: true
---

```{r}
#| include: false
#| file: setup.R
```


## Your turn {transition="slide-in"}

![](images/parsnip-flagger.jpg){.absolute top="0" right="0" width="150" height="150"}

*How do you fit a linear model in R?*

*How many different ways can you think of?*

```{r}
#| echo: false
countdown(minutes = 3)
```

. . .

-   `lm` for generalized linear model

-   `glmnet` for regularized regression

-   `keras` for regression using TensorFlow

-   `stan` for Bayesian regression

-   `spark` for large data sets

## To specify a model with parsnip `r hexes("parsnip")`

. . .

-   Choose a **model**
-   Specify an **engine**
-   Set the **mode**

## To specify a model with parsnip `r hexes("parsnip")`

```{r}
#| echo: false
library(tidyverse)
library(tidymodels)
library(dcflights21)
data(dcflights)

set.seed(123)
flights_split <- initial_split(dcflights, prop = 0.8, strata = dep_delay)
flights_train <- training(flights_split)
flights_test <- testing(flights_split)
```


```{r}
linear_reg()
```

## To specify a model with parsnip `r hexes("parsnip")`

```{r}
linear_reg() %>%
  set_engine("glmnet")
```

## To specify a model with parsnip `r hexes("parsnip")`

```{r}
linear_reg() %>%
  set_engine("stan")
```

## To specify a model with parsnip `r hexes("parsnip")`

```{r}
decision_tree()
```

## To specify a model with parsnip `r hexes("parsnip")`

```{r}
decision_tree() %>% 
  set_mode("regression")
```

. . .

::: smaller
All available models are listed at <https://www.tidymodels.org/find/parsnip/>
:::

##  {background-iframe="https://www.tidymodels.org/find/parsnip/"}

## Your turn {transition="slide-in"}

![](images/parsnip-flagger.jpg){.absolute top="0" right="0" width="150" height="150"}

*Run the `tree_spec` chunk in your `.Rmd`.*

*Edit this code so it fits a different model.*

```{r}
#| echo: false
countdown(minutes = 5)
```

::: smaller
All available models are listed at <https://www.tidymodels.org/find/parsnip/>
:::

# A model workflow

##  {background-image="https://media.giphy.com/media/xUA7b0Klw8Wfor7FWo/giphy.gif" background-size="800px"}

## 

```{r}
tree_spec <-
  decision_tree() %>% 
  set_mode("regression")

tree_spec %>% 
  fit(dep_delay ~ duration + hour, 
      data = flights_train) 
```

## 

```{r}
tree_spec <-
  decision_tree() %>% 
  set_mode("regression")

workflow() %>%
  add_model(tree_spec) %>%
  add_formula(dep_delay ~ duration + hour) %>%
  fit(data = flights_train) 
```

## 

```{r}
tree_spec <-
  decision_tree() %>% 
  set_mode("regression")

workflow() %>%
  add_model(tree_spec) %>%
  add_variables(outcomes = dep_delay, predictors = c(duration, hour)) %>%
  fit(data = flights_train) 
```

## 

```{r}
tree_spec <-
  decision_tree() %>% 
  set_mode("regression")

workflow(dep_delay ~ duration + hour, tree_spec) %>% 
  fit(data = flights_train) 
```
